<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mouse Parallax City</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Comic+Relief&display=swap" rel="stylesheet" />
    <style>
      html,
      body {
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #111;
      }
      .comic-relief-regular {
        font-family: 'Comic Relief', system-ui;
        font-weight: 400;
        font-style: normal;
      }

      body {
        width: 100vw;
        height: 100vh;
        position: relative;
        font-family: 'Comic Relief', cursive;
      }
      .parallax-layer {
        position: absolute;
        top: -10vh;
        left: -5vw;
        width: 110vw;
        height: 110vh;
        background-size: auto 100%;
        background-position: center;
        image-rendering: pixelated;
        filter: none;
        will-change: transform;
        transition: transform 0.35s cubic-bezier(0.4, 0.2, 0.2, 1);
        pointer-events: none;
      }
      /* Tambahkan style khusus untuk layer6 (rain) */
      #layer6 {
        width: 200vw;
        height: 200vh;
        top: -50vh;
        left: -15vw;
        background-size: auto 30%;
        background-repeat: repeat;
        /* Atur agar tetap di tengah dan tidak blur */
        image-rendering: pixelated;
        filter: none;
        pointer-events: none;
        opacity: 0.4; /* Tambahkan transparansi 40% */
      }
      .content {
        position: absolute;
        z-index: 10;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 3vw;
        pointer-events: auto;
        text-shadow: 0 2px 8px #000a;
      }
      @media (max-width: 600px) {
        .content {
          font-size: 5vw;
        }
      }
    </style>
  </head>
  <body>
    <!-- <div
      id="theme-switcher"
      style="
        position: absolute;
        left: 16px;
        top: 16px;
        z-index: 20;
        background: rgba(30, 30, 30, 0.7);
        padding: 10px 18px;
        border-radius: 10px;
        box-shadow: 0 2px 8px #0005;
      "
    >
      <button onclick="setTheme('city-1')" style="margin-right: 8px">Tema City 1</button>
      <button onclick="setTheme('city-3')">Tema City 3</button>
      <div style="font-size: 12px; color: #ccc; margin-top: 6px">
        Tambah tema baru: buat folder di <b>resource/</b> dengan nama sesuai tombol, lalu isi gambar 1.png-5.png.<br />
        Contoh: <b>resource/city 2/1.png</b> dst.<br />
        <i>Duplikat tombol di script untuk menambah pilihan.</i>
      </div>
    </div> -->
    <!-- Tombol Fullscreen di kanan atas -->
    <button
      id="fullscreen-btn"
      aria-label="Fullscreen"
      style="
        position: fixed;
        top: 18px;
        right: 18px;
        z-index: 1000;
        width: 38px;
        height: 38px;
        background: rgba(30, 30, 30, 0.7);
        border: none;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
      "
    >
      <!-- Icon fullscreen SVG 1:1 -->
      <svg id="fullscreen-icon" width="22" height="22" viewBox="0 0 22 22" fill="none">
        <rect x="2" y="2" width="6" height="2" rx="1" fill="#fff" />
        <rect x="2" y="2" width="2" height="6" rx="1" fill="#fff" />
        <rect x="14" y="2" width="6" height="2" rx="1" fill="#fff" />
        <rect x="18" y="2" width="2" height="6" rx="1" fill="#fff" />
        <rect x="2" y="18" width="6" height="2" rx="1" fill="#fff" />
        <rect x="2" y="14" width="2" height="6" rx="1" fill="#fff" />
        <rect x="14" y="18" width="6" height="2" rx="1" fill="#fff" />
        <rect x="18" y="14" width="2" height="6" rx="1" fill="#fff" />
      </svg>
    </button>
    <div class="parallax-layer" id="layer1" style="background-image: url('resource/city-1/1.png'); z-index: 1; top: -5px"></div>
    <div class="parallax-layer" id="layer2" style="background-image: url('resource/city-1/2.png'); z-index: 2; top: -5px"></div>
    <div class="parallax-layer" id="layer3" style="background-image: url('resource/city-1/3.png'); z-index: 3; top: 20px"></div>
    <div class="parallax-layer" id="layer4" style="background-image: url('resource/city-1/4.png'); z-index: 4; top: 20px"></div>
    <div class="parallax-layer" id="layer5" style="background-image: url('resource/city-1/5.png'); z-index: 5; top: 20px"></div>
    <div class="parallax-layer" id="layer6" style="background-image: url('resource/city-1/rainn.gif'); z-index: 6"></div>
    <div class="content">
      <div>
        <h1>Mouse Parallax City</h1>
        <p>Gerakkan mouse untuk melihat efek parallax!</p>
      </div>
    </div>
    <script>
      function setTheme(folder) {
        for (let i = 1; i <= 5; i++) {
          const layer = document.getElementById('layer' + i);
          layer.style.backgroundImage = `url('resource/${folder}/${i}.png')`;
        }
        // Ganti rain layer ke rainn.gif tanpa animasi JS
        document.getElementById('layer6').style.backgroundImage = `url('resource/${folder}/rainn.gif')`;
      }
      // Parallax speed factors (background to foreground, rain layer slightly in front)
      const speeds = [0.1, 0.2, 0.25, 0.5, 1, 2];
      const layers = [
        document.getElementById('layer1'),
        document.getElementById('layer2'),
        document.getElementById('layer3'),
        document.getElementById('layer4'),
        document.getElementById('layer5'),
        document.getElementById('layer6'),
      ];
      let target = { x: 0, y: 0 };
      let current = { x: 0, y: 0 };

      function lerp(a, b, t) {
        return a + (b - a) * t;
      }

      // Responsive parallax strength based on window width
      function getParallaxStrength() {
        // Nilai 0.045 pada desktop, lebih besar pada mobile agar feeling sama
        // 0.045 * 1920 ≈ 86px max movement per axis pada layar besar
        // 0.045 * 390 ≈ 17px pada layar mobile, terlalu kecil
        // Maka gunakan rasio tetap, misal 5% dari lebar/tinggi window
        return Math.max(window.innerWidth, window.innerHeight) * 0.05;
      }

      function animateParallax() {
        current.x = lerp(current.x, target.x, 0.12);
        current.y = lerp(current.y, target.y, 0.12);
        for (let i = 0; i < layers.length; i++) {
          const moveX = -current.x * speeds[i];
          const moveY = -current.y * speeds[i];
          layers[i].style.transform = `translate(${moveX}px, ${moveY}px)`;
        }
        requestAnimationFrame(animateParallax);
      }

      function updateTargetFromPointer(xNorm, yNorm) {
        // xNorm, yNorm: -1 ... 1
        const strength = getParallaxStrength();
        target.x = xNorm * strength;
        target.y = yNorm * strength;
      }

      window.addEventListener('mousemove', (e) => {
        const w = window.innerWidth;
        const h = window.innerHeight;
        const xNorm = (e.clientX / w - 0.5) * 2;
        const yNorm = (e.clientY / h - 0.5) * 2;
        updateTargetFromPointer(xNorm, yNorm);
      });

      window.addEventListener(
        'touchmove',
        (e) => {
          if (e.touches && e.touches.length > 0) {
            const t = e.touches[0];
            const w = window.innerWidth;
            const h = window.innerHeight;
            const xNorm = (t.clientX / w - 0.5) * 2;
            const yNorm = (t.clientY / h - 0.5) * 2;
            updateTargetFromPointer(xNorm, yNorm);
          }
        },
        { passive: true }
      );

      // Reset parallax strength on resize
      window.addEventListener('resize', () => {
        // Recalculate target so effect stays proportional
        target.x = 0;
        target.y = 0;
      });

      animateParallax();

      // Fullscreen toggle logic
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const fullscreenIcon = document.getElementById('fullscreen-icon');
      let isFullscreen = false;

      function enterFullscreen() {
        const docElm = document.documentElement;
        if (docElm.requestFullscreen) docElm.requestFullscreen();
        else if (docElm.mozRequestFullScreen) docElm.mozRequestFullScreen();
        else if (docElm.webkitRequestFullscreen) docElm.webkitRequestFullscreen();
        else if (docElm.msRequestFullscreen) docElm.msRequestFullscreen();
      }

      function exitFullscreen() {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        else if (document.msExitFullscreen) document.msExitFullscreen();
      }

      function updateFullscreenIcon() {
        if (
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement
        ) {
          // Change to "exit fullscreen" icon (arrows inward)
          fullscreenIcon.innerHTML = `
            <rect x="5" y="10" width="2" height="7" rx="1" fill="#fff"/>
            <rect x="10" y="5" width="7" height="2" rx="1" fill="#fff"/>
            <rect x="15" y="10" width="2" height="7" rx="1" fill="#fff"/>
            <rect x="10" y="15" width="7" height="2" rx="1" fill="#fff"/>
            <rect x="5" y="5" width="2" height="7" rx="1" fill="#fff"/>
            <rect x="10" y="5" width="7" height="2" rx="1" fill="#fff"/>
            <rect x="5" y="15" width="7" height="2" rx="1" fill="#fff"/>
            <rect x="15" y="5" width="2" height="7" rx="1" fill="#fff"/>
          `;
        } else {
          // Change to "enter fullscreen" icon (arrows outward)
          fullscreenIcon.innerHTML = `
            <rect x="2" y="2" width="6" height="2" rx="1" fill="#fff"/>
            <rect x="2" y="2" width="2" height="6" rx="1" fill="#fff"/>
            <rect x="14" y="2" width="6" height="2" rx="1" fill="#fff"/>
            <rect x="18" y="2" width="2" height="6" rx="1" fill="#fff"/>
            <rect x="2" y="18" width="6" height="2" rx="1" fill="#fff"/>
            <rect x="2" y="14" width="2" height="6" rx="1" fill="#fff"/>
            <rect x="14" y="18" width="6" height="2" rx="1" fill="#fff"/>
            <rect x="18" y="14" width="2" height="6" rx="1" fill="#fff"/>
          `;
        }
      }

      fullscreenBtn.addEventListener('click', () => {
        if (
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement
        ) {
          exitFullscreen();
        } else {
          enterFullscreen();
        }
      });

      document.addEventListener('fullscreenchange', updateFullscreenIcon);
      document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
      document.addEventListener('mozfullscreenchange', updateFullscreenIcon);
      document.addEventListener('MSFullscreenChange', updateFullscreenIcon);
    </script>
  </body>
</html>
